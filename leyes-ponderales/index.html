<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Laboratorio de Leyes Ponderales</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        @keyframes react {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.3); opacity: 0.7; filter: brightness(1.5); }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes bubble {
            0% { transform: translateY(0) scale(1); }
            50% { transform: translateY(-5px) scale(1.1); }
            100% { transform: translateY(-10px) scale(1); }
        }
        @keyframes escape {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-200px) translateX(var(--tx)); opacity: 0; }
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(20px); }
            to { opacity: 1; transform: translateX(0); }
        }
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }
        @keyframes slideIn { 
            from { transform: translateX(-20px); opacity: 0; } 
            to { transform: translateX(0); opacity: 1; } 
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        @keyframes glow {
            0%, 100% { box-shadow: 0 0 5px rgba(59, 130, 246, 0.5); }
            50% { box-shadow: 0 0 20px rgba(59, 130, 246, 0.8); }
        }

        .reaction-flash { animation: react 0.6s ease-in-out; }
        .exercise-card { animation: slideInRight 0.5s ease-out; }
        .slide-in { animation: slideIn 0.6s forwards; }
        .pulse-animation { animation: pulse 2s ease-in-out infinite; }
        .glow-animation { animation: glow 2s ease-in-out infinite; }
        
        .particle-reactant-a { 
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            border: 2px solid #1d4ed8; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 2px rgba(255,255,255,0.3);
        }
        .particle-reactant-b { 
            background: linear-gradient(135deg, #ffffff 0%, #e2e8f0 100%);
            border: 2px solid #94a3b8; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 2px rgba(255,255,255,0.5);
        }
        .particle-product-liq { 
            background: linear-gradient(135deg, #a855f7 0%, #9333ea 100%);
            border: 2px solid #7e22ce; 
            opacity: 0.8;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 0 1px 2px rgba(255,255,255,0.3);
        }
        .particle-gas { 
            background: linear-gradient(135deg, #64748b 0%, #475569 100%);
            border: 2px solid #1e293b;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 2px 2px 3px rgba(255,255,255,0.4);
            animation: bubble 2s infinite ease-in-out alternate;
        }
        .gas-escaping {
            --tx: 20px;
            animation: escape 1.5s forwards ease-out;
        }

        .scale-display {
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 8px rgba(34, 197, 94, 0.8);
            letter-spacing: 2px;
        }
        
        .tab-btn {
            position: relative;
            transition: all 0.3s ease;
        }
        .tab-btn.active {
            color: #3b82f6;
            font-weight: 600;
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            border-radius: 3px 3px 0 0;
        }
        .tab-btn:hover:not(.active) {
            color: #60a5fa;
        }
        .tab-content { 
            display: none; 
            animation: fadeIn 0.4s ease-in-out; 
        }
        .tab-content.active { display: block; }

        .molecule-h2 { display: flex; gap: 2px; align-items: center; }
        .atom-h { 
            width: 16px; 
            height: 16px; 
            background: linear-gradient(135deg, #cbd5e1 0%, #94a3b8 100%);
            border: 2px solid #475569; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 1px 1px 2px rgba(255,255,255,0.5);
        }
        
        .molecule-o2 { display: flex; gap: 2px; align-items: center; }
        .atom-o { 
            width: 22px; 
            height: 22px; 
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            border: 2px solid #b91c1c; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.2), inset 1px 1px 2px rgba(255,255,255,0.3);
        }
        
        .molecule-h2o { position: relative; width: 32px; height: 32px; margin: 2px; }
        .molecule-h2o .atom-o { position: absolute; left: 5px; top: 5px; }
        .molecule-h2o .atom-h:nth-child(2) { position: absolute; top: 0; left: 20px; }
        .molecule-h2o .atom-h:nth-child(3) { position: absolute; top: 20px; left: 0; }

        .atom-c { 
            width: 26px; 
            height: 26px; 
            background: linear-gradient(135deg, #475569 0%, #334155 100%);
            border: 2px solid #0f172a; 
            border-radius: 50%; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.3), inset 1px 1px 2px rgba(255,255,255,0.2);
        }
        .molecule-co { display: flex; align-items: center; gap: -4px; }
        .molecule-co2 { display: flex; align-items: center; gap: -4px; }
        
        .molecule-ch4 { position: relative; width: 44px; height: 44px; }
        .molecule-ch4 .atom-c { position: absolute; left: 9px; top: 9px; }
        .molecule-ch4 .atom-h:nth-child(2) { position: absolute; top: 0; left: 14px; }
        .molecule-ch4 .atom-h:nth-child(3) { position: absolute; bottom: 0; left: 14px; }
        .molecule-ch4 .atom-h:nth-child(4) { position: absolute; top: 14px; left: 0; }
        .molecule-ch4 .atom-h:nth-child(5) { position: absolute; top: 14px; right: 0; }

        .hover-lift {
            transition: all 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0,0,0,0.15);
        }

        .info-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }

        .progress-bar {
            height: 6px;
            background: #e2e8f0;
            border-radius: 10px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6 0%, #2563eb 100%);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-gradient-to-r from-blue-600 via-blue-700 to-indigo-700 text-white shadow-2xl">
        <div class="container mx-auto px-4 py-8">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-4xl font-bold mb-2">‚öóÔ∏è Laboratorio Virtual de Qu√≠mica</h1>
                    <p class="text-blue-100 text-lg">Descubre las Leyes Ponderales de forma interactiva</p>
                </div>
                <div class="hidden md:block">
                    <div class="bg-white/10 backdrop-blur-sm px-6 py-3 rounded-xl border border-white/20">
                        <div class="text-sm text-blue-100">Leyes Fundamentales</div>
                        <div class="text-2xl font-bold">4</div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="container mx-auto px-4">
            <div class="flex space-x-2 md:space-x-6 overflow-x-auto pb-1">
                <button onclick="switchTab('lavoisier')" id="btn-lavoisier" class="tab-btn active py-4 px-4 md:px-6 whitespace-nowrap transition text-sm md:text-base">
                    <span class="mr-2">‚öñÔ∏è</span> Lavoisier
                </button>
                <button onclick="switchTab('proust')" id="btn-proust" class="tab-btn py-4 px-4 md:px-6 whitespace-nowrap transition text-sm md:text-base">
                    <span class="mr-2">üìä</span> Proust
                </button>
                <button onclick="switchTab('dalton')" id="btn-dalton" class="tab-btn py-4 px-4 md:px-6 whitespace-nowrap transition text-sm md:text-base">
                    <span class="mr-2">üî¨</span> Dalton
                </button>
                <button onclick="switchTab('richter')" id="btn-richter" class="tab-btn py-4 px-4 md:px-6 whitespace-nowrap transition text-sm md:text-base">
                    <span class="mr-2">üîó</span> Richter
                </button>
            </div>
        </div>
    </nav>

    <main class="container mx-auto px-4 py-8 flex-grow">

        <!-- LEY DE LAVOISIER -->
        <div id="tab-lavoisier" class="tab-content active">
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div class="info-card p-8 rounded-2xl shadow-xl border border-slate-200 hover-lift">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">‚öñÔ∏è</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-blue-800">Ley de Lavoisier</h2>
                            <p class="text-sm text-slate-500">Conservaci√≥n de la Masa</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-yellow-50 to-amber-50 p-5 rounded-xl border-2 border-yellow-200 mb-6">
                        <p class="text-sm font-medium text-slate-700 mb-3 italic">
                            "La materia no se crea ni se destruye, solo se transforma"
                        </p>
                        <div class="text-center font-semibold text-amber-900 border-b-2 border-yellow-300 pb-3 mb-4">
                            Vinagre + Bicarbonato ‚Üí Acetato + CO‚ÇÇ
                        </div>
                        <div class="grid grid-cols-5 gap-2 text-[10px] text-slate-600">
                            <div class="flex flex-col items-center">
                                <div class="w-7 h-7 rounded-full particle-reactant-a mb-1 shadow-md"></div>
                                <span class="font-medium">Vinagre</span>
                            </div>
                            <div class="flex items-center justify-center"><span class="text-lg font-bold text-slate-400">+</span></div>
                            <div class="flex flex-col items-center">
                                <div class="w-7 h-7 rounded-full particle-reactant-b mb-1 shadow-md"></div>
                                <span class="font-medium">Bicarbonato</span>
                            </div>
                            <div class="flex items-center justify-center"><span class="text-lg font-bold text-slate-400">‚Üí</span></div>
                            <div class="flex flex-col items-center gap-2">
                                <div class="flex gap-1">
                                    <div class="w-6 h-6 rounded-full particle-product-liq shadow-md"></div>
                                    <div class="w-6 h-6 rounded-full particle-gas shadow-md" style="animation: none;"></div>
                                </div>
                                <span class="font-medium">Productos</span>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-3 mb-4">
                        <button id="btn-react-lavoisier" onclick="runLavoisier()" class="w-full bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-4 px-6 rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105">
                            <span class="text-lg">‚ñ∂Ô∏è</span> 1. Iniciar Reacci√≥n
                        </button>
                        <button id="btn-open-lavoisier" onclick="openSystem()" class="w-full bg-gradient-to-r from-orange-500 to-orange-600 hover:from-orange-600 hover:to-orange-700 text-white font-bold py-4 px-6 rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 hidden">
                            <span class="text-lg">üîì</span> 2. Abrir Recipiente
                        </button>
                    </div>
                    
                    <button onclick="resetLavoisier()" class="w-full text-slate-500 hover:text-slate-700 text-sm py-2 font-medium transition">
                        üîÑ Reiniciar Experimento
                    </button>
                    
                    <div id="lavoisier-result" class="mt-6 hidden p-5 rounded-xl bg-gradient-to-br from-slate-50 to-slate-100 border-2 border-slate-200"></div>
                </div>

                <div class="bg-gradient-to-br from-slate-200 to-slate-300 p-8 rounded-2xl shadow-2xl flex flex-col items-center justify-end h-[500px] relative border-4 border-slate-400">
                    <div class="absolute top-4 left-4 bg-white/80 backdrop-blur-sm px-4 py-2 rounded-lg shadow-md">
                        <span class="text-xs font-bold text-slate-600 uppercase tracking-wide">Simulaci√≥n en Tiempo Real</span>
                    </div>
                    
                    <div class="relative w-52 h-72 bg-white/50 backdrop-blur-md border-4 border-slate-500 rounded-b-[40px] rounded-t-2xl shadow-2xl overflow-hidden z-10">
                        <div id="flask-stopper" class="absolute -top-1 left-14 w-24 h-8 bg-gradient-to-b from-amber-900 to-amber-800 rounded-sm z-20 transition-all duration-1000 shadow-lg border-2 border-amber-950"></div>
                        
                        <div class="absolute bottom-0 w-full h-28 bg-gradient-to-t from-blue-100 to-blue-50 transition-colors duration-1000 flex flex-wrap content-end justify-center p-2 gap-1 z-0 border-t-2 border-blue-200" id="flask-contents"></div>
                        
                        <div id="gas-container" class="absolute top-10 w-full h-36 pointer-events-none z-10"></div>
                    </div>

                    <div class="w-72 h-16 bg-gradient-to-b from-slate-700 to-slate-900 mt-4 rounded-xl flex items-center justify-center border-b-8 border-slate-950 shadow-2xl relative z-0">
                        <div class="bg-black px-6 py-2 rounded-lg border-2 border-green-600 glow-animation">
                            <span id="scale-value" class="scale-display text-green-500 text-2xl font-bold">250.00 g</span>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="info-card rounded-2xl shadow-xl border-t-4 border-blue-500 p-8 hover-lift">
                <div id="start-screen-lavoisier" class="text-center py-12">
                    <div class="text-6xl mb-4">üéØ</div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">Desaf√≠o: Conservaci√≥n de la Masa</h3>
                    <p class="text-slate-600 mb-8 text-lg">Pon a prueba tus conocimientos con 15 ejercicios interactivos</p>
                    <button onclick="startQuiz('lavoisier')" class="bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-700 hover:to-indigo-700 text-white px-12 py-4 rounded-full font-bold text-lg transition shadow-xl transform hover:scale-110">
                        üöÄ Comenzar Test
                    </button>
                </div>
                <div id="quiz-container-lavoisier" class="hidden"></div>
            </div>
        </div>

        <!-- LEY DE PROUST -->
        <div id="tab-proust" class="tab-content">
            <div class="grid lg:grid-cols-3 gap-8 mb-8">
                <div class="lg:col-span-1 info-card p-8 rounded-2xl shadow-xl border border-slate-200 hover-lift">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-indigo-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">üìä</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-indigo-800">Ley de Proust</h2>
                            <p class="text-sm text-slate-500">Proporciones Definidas</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-indigo-50 to-purple-50 p-5 rounded-xl border-2 border-indigo-200 mb-6">
                        <p class="text-sm font-medium text-slate-700 mb-3 italic">
                            "Un compuesto puro siempre contiene los mismos elementos combinados en las mismas proporciones en masa, independientemente de su origen o m√©todo de preparaci√≥n."
                        </p>
                        <div class="border-t-2 border-indigo-200 pt-3 mt-3">
                            <p class="text-sm font-medium text-slate-700 mb-2">
                                <span class="font-bold text-indigo-700">Ejemplo:</span> La proporci√≥n <span class="font-bold text-indigo-700">H:O</span> en el agua siempre es <span class="font-bold text-indigo-700">1:8</span> en masa.
                            </p>
                            <p class="text-xs text-slate-500">(1 mol O‚ÇÇ = 32g, 1 mol H‚ÇÇ = 2g)</p>
                        </div>
                    </div>
                    
                    <div class="space-y-5 mb-6">
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-blue-100">
                            <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                                <span class="w-3 h-3 rounded-full bg-slate-400 mr-2"></span>
                                Hidr√≥geno (H‚ÇÇ)
                            </label>
                            <input type="range" id="input-h" min="0" max="20" step="2" value="4" class="w-full accent-blue-500 h-2 rounded-lg" oninput="updateProustInput()">
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span>0g</span>
                                <span id="val-h" class="font-bold text-blue-600 text-lg">4g</span>
                                <span>20g</span>
                            </div>
                        </div>
                        
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-red-100">
                            <label class="block text-sm font-bold text-slate-700 mb-2 flex items-center">
                                <span class="w-3 h-3 rounded-full bg-red-500 mr-2"></span>
                                Ox√≠geno (O‚ÇÇ)
                            </label>
                            <input type="range" id="input-o" min="0" max="128" step="32" value="32" class="w-full accent-red-500 h-2 rounded-lg" oninput="updateProustInput()">
                            <div class="flex justify-between text-xs text-slate-500 mt-2">
                                <span>0g</span>
                                <span id="val-o" class="font-bold text-red-600 text-lg">32g</span>
                                <span>128g</span>
                            </div>
                        </div>
                    </div>
                    
                    <button onclick="calculateProust()" class="w-full bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white font-bold py-4 rounded-xl shadow-lg hover:shadow-xl transform hover:scale-105 transition">
                        ‚öóÔ∏è Iniciar Reacci√≥n
                    </button>
                    
                    <div id="proust-feedback" class="mt-4 text-sm hidden"></div>
                </div>
                
                <div class="lg:col-span-2 bg-gradient-to-br from-slate-50 to-slate-100 p-8 rounded-2xl shadow-xl border-2 border-slate-200 flex flex-col gap-6">
                    <div class="info-card p-6 rounded-xl shadow-lg border-2 border-slate-200">
                        <h3 class="text-center text-sm font-bold text-slate-600 mb-4 uppercase tracking-wide flex items-center justify-center">
                            <span class="w-2 h-2 bg-blue-500 rounded-full mr-2"></span>
                            Reactivos Iniciales
                        </h3>
                        <div id="container-reactants" class="flex flex-wrap gap-4 min-h-[80px] content-start justify-center bg-white/50 p-4 rounded-lg"></div>
                    </div>
                    
                    <div class="info-card p-6 rounded-xl shadow-lg border-2 border-slate-200 flex-grow flex flex-col">
                        <h3 class="text-center text-sm font-bold text-slate-600 mb-4 uppercase tracking-wide flex items-center justify-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mr-2"></span>
                            Resultados de la Reacci√≥n
                        </h3>
                        <div class="flex flex-grow border-2 rounded-xl overflow-hidden min-h-[280px]">
                            <div class="w-1/2 bg-gradient-to-br from-blue-50 to-cyan-50 border-r-2 border-slate-200 p-4 overflow-y-auto">
                                <div class="text-xs font-bold text-blue-700 text-center mb-3 uppercase tracking-wider bg-white/70 py-2 rounded-lg">
                                    üíß Producto: Agua (H‚ÇÇO)
                                </div>
                                <div id="container-products-water" class="flex flex-wrap gap-3 content-start justify-center"></div>
                            </div>
                            <div class="w-1/2 bg-gradient-to-br from-red-50 to-orange-50 p-4 overflow-y-auto">
                                <div class="text-xs font-bold text-red-700 text-center mb-3 uppercase tracking-wider bg-white/70 py-2 rounded-lg">
                                    ‚ö†Ô∏è Exceso (Sin Reaccionar)
                                </div>
                                <div id="container-products-excess" class="flex flex-wrap gap-3 content-start justify-center">
                                    <span class="text-slate-400 text-sm italic w-full text-center mt-6 opacity-60">Esperando reacci√≥n...</span>
                                </div>
                            </div>
                        </div>
                        <div class="mt-4 bg-amber-50 border-2 border-amber-200 rounded-lg p-3">
                            <p class="text-xs text-center text-amber-800 font-medium">
                                üí° <strong>Observa:</strong> La suma total de √°tomos (bolas) se mantiene constante
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card rounded-2xl shadow-xl border-t-4 border-indigo-500 p-8 hover-lift">
                <div id="start-screen-proust" class="text-center py-12">
                    <div class="text-6xl mb-4">üìê</div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">Desaf√≠o: Proporciones Definidas</h3>
                    <p class="text-slate-600 mb-8 text-lg">Domina los c√°lculos estequiom√©tricos con ejercicios pr√°cticos</p>
                    <button onclick="startQuiz('proust')" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-12 py-4 rounded-full font-bold text-lg transition shadow-xl transform hover:scale-110">
                        üöÄ Comenzar Test
                    </button>
                </div>
                <div id="quiz-container-proust" class="hidden"></div>
            </div>
        </div>

        <!-- LEY DE DALTON -->
        <div id="tab-dalton" class="tab-content">
            <div class="grid md:grid-cols-2 gap-8 mb-8">
                <div class="info-card p-8 rounded-2xl shadow-xl border border-slate-200 hover-lift">
                    <div class="flex items-center mb-4">
                        <div class="w-12 h-12 bg-orange-100 rounded-full flex items-center justify-center mr-4">
                            <span class="text-2xl">üî¨</span>
                        </div>
                        <div>
                            <h2 class="text-2xl font-bold text-orange-800">Ley de Dalton</h2>
                            <p class="text-sm text-slate-500">Proporciones M√∫ltiples</p>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-orange-50 to-amber-50 p-5 rounded-xl border-2 border-orange-200 mb-6">
                        <p class="text-sm font-medium text-slate-700 italic">
                            "Las masas de un elemento que se combinan con una masa fija de otro guardan una relaci√≥n de n√∫meros enteros sencillos"
                        </p>
                    </div>
                    
                    <div class="bg-white p-5 rounded-xl mb-6 border-2 border-slate-200 shadow-sm">
                        <p class="text-sm font-bold mb-3 text-slate-700 text-center">Elemento Fijo: Carbono</p>
                        <div class="flex justify-center items-center gap-2">
                            <div class="atom-c pulse-animation"></div>
                            <span class="text-lg font-bold text-slate-600">12g</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        <button onclick="runDalton(1)" class="w-full bg-gradient-to-r from-orange-100 to-orange-200 hover:from-orange-200 hover:to-orange-300 text-orange-900 font-bold py-4 px-6 rounded-xl border-2 border-orange-300 flex justify-between items-center group shadow-md hover:shadow-lg transition transform hover:scale-105">
                            <span class="flex items-center">
                                <span class="text-2xl mr-3">A</span>
                                <span>+16g Ox√≠geno</span>
                            </span>
                            <span class="text-xs bg-white px-3 py-2 rounded-lg group-hover:bg-orange-50 font-semibold">‚Üí CO</span>
                        </button>
                        
                        <button onclick="runDalton(2)" class="w-full bg-gradient-to-r from-red-100 to-red-200 hover:from-red-200 hover:to-red-300 text-red-900 font-bold py-4 px-6 rounded-xl border-2 border-red-300 flex justify-between items-center group shadow-md hover:shadow-lg transition transform hover:scale-105">
                            <span class="flex items-center">
                                <span class="text-2xl mr-3">B</span>
                                <span>+32g Ox√≠geno</span>
                            </span>
                            <span class="text-xs bg-white px-3 py-2 rounded-lg group-hover:bg-red-50 font-semibold">‚Üí CO‚ÇÇ</span>
                        </button>
                    </div>
                </div>
                
                <div class="bg-gradient-to-br from-slate-800 to-slate-900 text-white p-8 rounded-2xl shadow-2xl flex flex-col items-center justify-center relative min-h-[400px] border-4 border-slate-700">
                    <div class="absolute top-4 left-4 bg-white/10 backdrop-blur-sm px-4 py-2 rounded-lg border border-white/20">
                        <span class="text-slate-300 text-xs font-mono uppercase tracking-widest">C√°mara de Reacci√≥n</span>
                    </div>
                    <div id="dalton-stage" class="flex flex-col items-center gap-8">
                        <div class="text-center opacity-60 text-lg">
                            <div class="text-4xl mb-3">‚öóÔ∏è</div>
                            Selecciona una opci√≥n para iniciar
                        </div>
                    </div>
                    <div id="dalton-ratio" class="absolute bottom-6 w-full px-6 text-center hidden">
                        <div class="bg-gradient-to-r from-slate-700 to-slate-800 p-4 rounded-xl border-2 border-slate-600 shadow-xl">
                            <p class="text-xs text-slate-300 uppercase tracking-widest mb-2 font-bold">üìä Relaci√≥n de Ox√≠geno</p>
                            <p class="text-xl font-mono text-yellow-300">32g (CO‚ÇÇ) : 16g (CO) = <span class="text-3xl font-bold text-white">2:1</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="info-card rounded-2xl shadow-xl border-t-4 border-orange-500 p-8 hover-lift">
                <div id="start-screen-dalton" class="text-center py-12">
                    <div class="text-6xl mb-4">üßÆ</div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">Desaf√≠o: Proporciones M√∫ltiples</h3>
                    <p class="text-slate-600 mb-8 text-lg">Descubre las relaciones de masa en compuestos diferentes</p>
                    <button onclick="startQuiz('dalton')" class="bg-gradient-to-r from-orange-600 to-red-600 hover:from-orange-700 hover:to-red-700 text-white px-12 py-4 rounded-full font-bold text-lg transition shadow-xl transform hover:scale-110">
                        üöÄ Comenzar Test
                    </button>
                </div>
                <div id="quiz-container-dalton" class="hidden"></div>
            </div>
        </div>

        <!-- LEY DE RICHTER -->
        <div id="tab-richter" class="tab-content">
            <div class="info-card p-8 rounded-2xl shadow-xl border border-slate-200 mb-8 hover-lift">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-purple-100 rounded-full flex items-center justify-center mr-4">
                        <span class="text-2xl">üîó</span>
                    </div>
                    <div>
                        <h2 class="text-2xl font-bold text-purple-800">Ley de Richter</h2>
                        <p class="text-sm text-slate-500">Proporciones Rec√≠procas</p>
                    </div>
                </div>
                <div class="bg-gradient-to-r from-purple-50 to-indigo-50 p-5 rounded-xl border-2 border-purple-200">
                    <p class="text-sm font-medium text-slate-700 italic">
                        "Las masas de dos elementos que se combinan con una masa fija de un tercero, guardan la misma relaci√≥n que cuando se combinan entre s√≠"
                    </p>
                </div>
            </div>
            
            <div class="grid md:grid-cols-3 gap-6 mb-8">
                <div class="info-card p-6 rounded-xl border-2 border-blue-200 flex flex-col items-center text-center relative overflow-hidden group hover:shadow-xl transition transform hover:scale-105">
                    <div class="absolute top-0 left-0 bg-gradient-to-r from-blue-500 to-blue-600 text-white text-xs font-bold px-4 py-2 rounded-br-xl shadow-lg">Paso 1</div>
                    <div class="mt-10 mb-4 flex gap-4 items-center">
                        <div class="atom-c"></div> 
                        <span class="text-3xl font-bold text-slate-400">+</span> 
                        <div class="molecule-o2"><div class="atom-o"></div><div class="atom-o"></div></div>
                    </div>
                    <p class="text-sm text-slate-600 mb-3 font-medium">12g Carbono + 32g Ox√≠geno</p>
                    <button onclick="runRichter(1)" class="bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white px-6 py-2 rounded-full text-sm font-bold shadow-md hover:shadow-lg transition transform hover:scale-105 mb-3">
                        ‚ö° Reaccionar
                    </button>
                    <div id="richter-res-1" class="h-20 flex items-center justify-center w-full bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg opacity-0 transition-opacity duration-500 border-2 border-slate-200"></div>
                </div>
                
                <div class="info-card p-6 rounded-xl border-2 border-red-200 flex flex-col items-center text-center relative overflow-hidden group hover:shadow-xl transition transform hover:scale-105">
                    <div class="absolute top-0 left-0 bg-gradient-to-r from-red-500 to-red-600 text-white text-xs font-bold px-4 py-2 rounded-br-xl shadow-lg">Paso 2</div>
                    <div class="mt-10 mb-4 flex gap-4 items-center">
                        <div class="flex flex-col gap-1">
                            <div class="molecule-h2"><div class="atom-h"></div><div class="atom-h"></div></div>
                            <div class="molecule-h2"><div class="atom-h"></div><div class="atom-h"></div></div>
                        </div> 
                        <span class="text-3xl font-bold text-slate-400">+</span> 
                        <div class="molecule-o2"><div class="atom-o"></div><div class="atom-o"></div></div>
                    </div>
                    <p class="text-sm text-slate-600 mb-3 font-medium">4g Hidr√≥geno + 32g Ox√≠geno</p>
                    <button onclick="runRichter(2)" class="bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white px-6 py-2 rounded-full text-sm font-bold shadow-md hover:shadow-lg transition transform hover:scale-105 mb-3">
                        ‚ö° Reaccionar
                    </button>
                    <div id="richter-res-2" class="h-20 flex items-center justify-center w-full bg-gradient-to-br from-slate-50 to-slate-100 rounded-lg opacity-0 transition-opacity duration-500 border-2 border-slate-200"></div>
                </div>
                
                <div class="bg-gradient-to-br from-indigo-50 to-purple-50 p-6 rounded-xl border-4 border-indigo-300 flex flex-col items-center text-center relative overflow-hidden ring-4 ring-indigo-100 shadow-xl">
                    <div class="absolute top-0 left-0 bg-gradient-to-r from-indigo-600 to-purple-600 text-white text-xs font-bold px-4 py-2 rounded-br-xl shadow-lg">Conclusi√≥n</div>
                    <div class="mt-10 mb-4 flex gap-4 items-center">
                        <div class="atom-c pulse-animation"></div> 
                        <span class="text-3xl font-bold text-indigo-400">+</span> 
                        <div class="flex flex-col gap-1">
                            <div class="molecule-h2"><div class="atom-h"></div><div class="atom-h"></div></div>
                            <div class="molecule-h2"><div class="atom-h"></div><div class="atom-h"></div></div>
                        </div>
                    </div>
                    <p class="text-sm text-indigo-900 mb-3 font-bold">¬øC√≥mo reaccionan C y H entre s√≠?</p>
                    <button onclick="runRichter(3)" class="bg-gradient-to-r from-indigo-600 to-purple-600 hover:from-indigo-700 hover:to-purple-700 text-white px-8 py-3 rounded-full text-sm font-bold shadow-xl hover:shadow-2xl transition transform hover:scale-110 mb-3">
                        üîó Combinar
                    </button>
                    <div id="richter-res-3" class="h-20 flex items-center justify-center w-full bg-white rounded-lg opacity-0 transition-opacity duration-500 border-2 border-indigo-200"></div>
                </div>
            </div>

            <div class="info-card rounded-2xl shadow-xl border-t-4 border-purple-500 p-8 hover-lift">
                <div id="start-screen-richter" class="text-center py-12">
                    <div class="text-6xl mb-4">üß©</div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">Desaf√≠o: Proporciones Rec√≠procas</h3>
                    <p class="text-slate-600 mb-8 text-lg">Entiende las triangulaciones qu√≠micas de Richter</p>
                    <button onclick="startQuiz('richter')" class="bg-gradient-to-r from-purple-600 to-indigo-600 hover:from-purple-700 hover:to-indigo-700 text-white px-12 py-4 rounded-full font-bold text-lg transition shadow-xl transform hover:scale-110">
                        üöÄ Comenzar Test
                    </button>
                </div>
                <div id="quiz-container-richter" class="hidden"></div>
            </div>
        </div>

    </main>

    <footer class="bg-slate-800 text-white py-6 mt-12">
        <div class="container mx-auto px-4 text-center">
            <p class="text-sm text-slate-300">üß™ Laboratorio Virtual de Qu√≠mica ‚Ä¢ Leyes Ponderales Fundamentales</p>
            <p class="text-xs text-slate-400 mt-2">Desarrollado para el aprendizaje interactivo de qu√≠mica</p>
            <p class="text-xs text-slate-500 mt-3">Realizado por Javier Gij√≥n ‚Ä¢ Profesor del IES Mar√≠a Moliner (Segovia)</p>
        </div>
    </footer>

    <script>
        // BASE DE DATOS DE EJERCICIOS
        const exercisesDB = {
            lavoisier: [
                { q: "Se hacen reaccionar 10g de Azufre con 10g de Hierro. Sobran 2g de Azufre. ¬øCu√°nto FeS se form√≥?", type: "numeric", val: 18, units: ["g", "gr", "gramos"], explanation: "Masa inicial total: 20g. Masa sobrante: 2g. Por conservaci√≥n: Producto = 20 - 2 = 18g." },
                { q: "100g de CaCO‚ÇÉ se calientan y producen 56g de CaO y CO‚ÇÇ. ¬øCu√°l es la masa del CO‚ÇÇ?", type: "numeric", val: 44, units: ["g", "gr", "gramos"], explanation: "Por conservaci√≥n: 100g = 56g (CaO) + X (CO‚ÇÇ). X = 100 - 56 = 44g." },
                { q: "¬øPor qu√© las cenizas de un papel pesan menos que el papel original?", type: "choice", options: ["La masa desapareci√≥", "Se escaparon gases (CO‚ÇÇ, H‚ÇÇO)", "El fuego destruye materia", "Error de la balanza"], correct: 1, explanation: "La masa faltante se convirti√≥ en gases (humo, vapor de agua, CO‚ÇÇ) que escaparon al aire en un sistema abierto." },
                { q: "Si disuelves 20g de sal en 50g de agua en un frasco cerrado herm√©ticamente, ¬øcu√°l es la masa total del sistema?", type: "numeric", val: 70, units: ["g", "gr", "gramos"], explanation: "En un sistema cerrado, la masa se conserva: 20g + 50g = 70g." },
                { q: "Una vela arde dentro de un frasco herm√©ticamente cerrado. ¬øCambia la masa total del frasco?", type: "choice", options: ["S√≠, disminuye", "S√≠, aumenta", "No cambia", "Depende del tipo de vela"], correct: 2, explanation: "En un sistema cerrado, la masa de reactivos (cera + O‚ÇÇ) es igual a la masa de productos (CO‚ÇÇ + H‚ÇÇO vapor)." },
                { q: "En la reacci√≥n 2H‚ÇÇ + O‚ÇÇ ‚Üí 2H‚ÇÇO, si usas 4g de H‚ÇÇ y 32g de O‚ÇÇ, ¬øcu√°nta agua obtienes?", type: "numeric", val: 36, units: ["g", "gr", "gramos"], explanation: "Masa total inicial = 4g + 32g = 36g. Todo se convierte en agua: 36g." },
                { q: "La descomposici√≥n del √≥xido de mercurio (HgO): 216g producen 200g de mercurio (Hg) y ox√≠geno (O‚ÇÇ). ¬øCu√°nto O‚ÇÇ se form√≥?", type: "numeric", val: 16, units: ["g", "gr", "gramos"], explanation: "Por conservaci√≥n: 216g = 200g (Hg) + X (O‚ÇÇ). X = 16g." },
                { q: "Mezclas vinagre y bicarbonato en un vaso abierto. La masa final es menor que la inicial. ¬øViola esto la ley de Lavoisier?", type: "choice", options: ["S√≠, la viola", "No, porque el sistema es abierto", "No, la masa se destruy√≥", "S√≠, es una excepci√≥n conocida"], correct: 1, explanation: "No viola la ley. El CO‚ÇÇ (gas) escap√≥ porque el sistema estaba abierto al ambiente." },
                { q: "Mezclas vinagre y bicarbonato dentro de un globo cerrado herm√©ticamente. ¬øQu√© sucede con la masa total del sistema?", type: "choice", options: ["Aumenta", "Disminuye", "Se mantiene igual", "El globo flota"], correct: 2, explanation: "Sistema cerrado = masa constante. El gas queda atrapado dentro del globo." },
                { q: "Una planta crece en una maceta y gana masa con el tiempo. ¬øDe d√≥nde proviene esta masa adicional?", type: "choice", options: ["Se crea de la nada", "Del CO‚ÇÇ del aire y agua del suelo", "Solo de la tierra", "Directamente del sol"], correct: 1, explanation: "La planta toma CO‚ÇÇ del aire y agua del suelo mediante fotos√≠ntesis. La masa no se crea, se transforma." },
                { q: "Quemas completamente 12g de carbono con ox√≠geno y obtienes 44g de CO‚ÇÇ. ¬øCu√°nto O‚ÇÇ reaccion√≥?", type: "numeric", val: 32, units: ["g", "gr", "gramos"], explanation: "Masa reactivos (12g C + X O‚ÇÇ) = Masa productos (44g CO‚ÇÇ). X = 44 - 12 = 32g." },
                { q: "Calientas 25g de CuSO‚ÇÑ¬∑5H‚ÇÇO (sulfato de cobre hidratado) y obtienes 16g de s√≥lido blanco anhidro. ¬øCu√°l es la masa de agua perdida?", type: "numeric", val: 9, units: ["g", "gr", "gramos"], explanation: "Masa inicial (25g) = Masa s√≥lido final (16g) + Agua perdida. Agua = 25 - 16 = 9g." },
                { q: "Mezclas 1L de l√≠quido A (densidad=1g/mL) con 500mL de l√≠quido B (densidad=0.8g/mL). ¬øCu√°l es la masa total de la mezcla?", type: "numeric", val: 1400, units: ["g", "gr", "gramos"], explanation: "Masa A = 1000mL √ó 1g/mL = 1000g. Masa B = 500mL √ó 0.8g/mL = 400g. Total = 1400g." },
                { q: "50g de un reactivo se descomponen en un vaso abierto dejando 30g de s√≥lido. ¬øCu√°l es la masa aparente 'perdida' medida por la balanza?", type: "numeric", val: 20, units: ["g", "gr", "gramos"], explanation: "El gas liberado tiene una masa de 20g (50 - 30). En sistema abierto, este gas escapa." },
                { q: "Si 10g de sustancia A reaccionan con 10g de sustancia B para formar 18g de producto C y 2g de producto D, ¬øes esto posible seg√∫n Lavoisier?", type: "choice", options: ["Imposible, sobra masa", "Imposible, falta masa", "Posible, cumple la ley", "No hay datos suficientes"], correct: 2, explanation: "Reactivos: 10 + 10 = 20g. Productos: 18 + 2 = 20g. La masa se conserva perfectamente." }
            ],
            proust: [
                { q: "La relaci√≥n H:O en agua es 1:8 en masa. Si tienes 10g de hidr√≥geno, ¬øcu√°nto ox√≠geno necesitas para reaccionar completamente?", type: "numeric", val: 80, units: ["g", "gr", "gramos"], explanation: "Si 1g H requiere 8g O, entonces 10g H requieren 10 √ó 8 = 80g O." },
                { q: "En CO‚ÇÇ la relaci√≥n C:O es 3:8. Si usas 6g de C y 20g de O, ¬øqu√© elemento es el reactivo limitante?", type: "choice", options: ["Carbono", "Ox√≠geno", "Ninguno", "Ambos por igual"], correct: 0, explanation: "6g C necesitan (6/3) √ó 8 = 16g O. Tienes 20g O (sobran 4g). Se acaba primero el carbono." },
                { q: "En NaCl la proporci√≥n Na:Cl es aproximadamente 23:35.5. Con 46g de Na y 71g de Cl, ¬øsobra alg√∫n reactivo?", type: "choice", options: ["Sobra Na", "Sobra Cl", "No sobra nada", "Faltan ambos"], correct: 2, explanation: "46g = 2 √ó 23g (Na). 71g = 2 √ó 35.5g (Cl). Proporci√≥n exacta 2:2, reacci√≥n completa." },
                { q: "Dos muestras de 'agua pura' analizadas tienen diferentes porcentajes de ox√≠geno. ¬øQu√© conclusi√≥n sacas?", type: "choice", options: ["La ley de Proust falla", "Una muestra es impura", "El agua var√≠a naturalmente", "Es completamente normal"], correct: 1, explanation: "Agua pura SIEMPRE tiene la misma proporci√≥n H:O. Si difiere, una muestra contiene impurezas." },
                { q: "El sulfuro de hierro tiene proporci√≥n Fe:S de 7:4 en masa. Si tienes 7g de Fe y 5g de S, ¬øqu√© masa de S sobra sin reaccionar?", type: "numeric", val: 1, units: ["g", "gr", "gramos"], explanation: "7g Fe consumen exactamente 4g S. Si tienes 5g S, sobra 5 - 4 = 1g." },
                { q: "Al quemar cinta de magnesio (Mg) para formar √≥xido de magnesio (MgO), la proporci√≥n Mg:O siempre es constante. ¬øQu√© ley ilustra esto?", type: "choice", options: ["Lavoisier", "Proust", "Dalton", "Richter"], correct: 1, explanation: "Proporciones Definidas constantes = Ley de Proust." },
                { q: "Si una receta de pastel requiere 2 huevos por cada 1 taza de harina, y tienes 5 huevos con 1 taza de harina, ¬øcu√°ntos huevos sobrar√°n?", type: "numeric", val: 3, units: ["h", "huevos", "unidades"], explanation: "1 taza acepta solo 2 huevos. Sobran 5 - 2 = 3 huevos." },
                { q: "El amon√≠aco (NH‚ÇÉ) tiene relaci√≥n N:H de 14:3 en masa. Si tienes 28g de nitr√≥geno, ¬øcu√°nto hidr√≥geno necesitas?", type: "numeric", val: 6, units: ["g", "gr", "gramos"], explanation: "28g es el doble de 14. Necesitas el doble de 3 = 6g H." },
                { q: "En SO‚ÇÉ la relaci√≥n S:O es 2:3 en masa. Si tienes 4g de azufre, ¬øcu√°nto ox√≠geno se combinar√°?", type: "numeric", val: 6, units: ["g", "gr", "gramos"], explanation: "4g es el doble de 2. Necesitas el doble de 3 = 6g O." },
                { q: "Si a√±ades m√°s reactivo del necesario a una reacci√≥n qu√≠mica, ¬øse formar√° autom√°ticamente m√°s producto?", type: "choice", options: ["S√≠, siempre", "No, el exceso queda sin reaccionar", "Depende de la temperatura", "S√≠, si agitas bien"], correct: 1, explanation: "El reactivo limitante determina la cantidad de producto. El exceso simplemente sobra." },
                { q: "Tienes 100g de una muestra de hierro al 80% de pureza. Reacciona con azufre en proporci√≥n Fe:S = 7:4. ¬øCu√°nto S reacciona realmente?", type: "numeric", val: 45.7, units: ["g", "gr", "gramos"], explanation: "Fe puro = 80g. Por proporci√≥n: (80 √ó 4) / 7 = 45.71g ‚âà 45.7g de S." },
                { q: "Un compuesto XY contiene 40% de X y 60% de Y en masa. Si tienes 10g de X, ¬øcu√°nto Y necesitas?", type: "numeric", val: 15, units: ["g", "gr", "gramos"], explanation: "Proporci√≥n X:Y = 40:60 = 2:3. Si X = 10g (√ó5), entonces Y = 15g." },
                { q: "Muestra A: 3g de X + 2g de Y. Muestra B: 9g de X + 6g de Y. ¬øSon el mismo compuesto?", type: "choice", options: ["S√≠, tienen la misma proporci√≥n", "No, masas totalmente distintas", "No se puede determinar", "Son is√≥topos diferentes"], correct: 0, explanation: "A: 3/2 = 1.5. B: 9/6 = 1.5. Misma proporci√≥n = mismo compuesto." },
                { q: "10g de cobre reaccionan con azufre (proporci√≥n Cu:S = 2:1). Si usas 10g de S, ¬øqu√© masa de producto (CuS) se forma?", type: "numeric", val: 15, units: ["g", "gr", "gramos"], explanation: "10g Cu necesitan 5g S. Se forman 10 + 5 = 15g de producto. Sobran 5g de S." },
                { q: "Quieres obtener 88g de FeS (proporci√≥n Fe:S = 7:4). ¬øCu√°nto hierro necesitas al inicio?", type: "numeric", val: 56, units: ["g", "gr", "gramos"], explanation: "Partes totales = 7 + 4 = 11. Factor = 88/11 = 8. Fe = 7 √ó 8 = 56g." }
            ],
            dalton: [
                { q: "√ìxidos de nitr√≥geno: NO (relaci√≥n 14:16) y NO‚ÇÇ (relaci√≥n 14:32). Para una misma masa de N, ¬øcu√°l es la relaci√≥n de masas de O?", type: "choice", options: ["1:1", "1:2", "2:3", "1:3"], correct: 1, explanation: "16g O en NO vs 32g O en NO‚ÇÇ. Relaci√≥n 16:32 = 1:2." },
                { q: "√ìxidos de carbono: CO (12g C con 16g O) y CO‚ÇÇ (12g C con 32g O). Si en CO hay 8g de O para 6g de C, ¬øcu√°nto O habr√° en CO‚ÇÇ para los mismos 6g de C?", type: "numeric", val: 16, units: ["g", "gr", "gramos"], explanation: "En CO‚ÇÇ la cantidad de O es el doble que en CO para igual C. 2 √ó 8 = 16g." },
                { q: "¬øQu√© par de compuestos demuestra mejor la ley de las proporciones m√∫ltiples de Dalton?", type: "choice", options: ["H‚ÇÇO y NaCl", "H‚ÇÇO y H‚ÇÇO‚ÇÇ", "CO‚ÇÇ y O‚ÇÇ", "Fe y S"], correct: 1, explanation: "Mismos elementos (H y O) en proporciones diferentes: H‚ÇÇO vs H‚ÇÇO‚ÇÇ." },
                { q: "Un metal M forma dos cloruros: MCl‚ÇÇ y MCl‚ÇÉ. Para 1g de M, ¬øcu√°l es la relaci√≥n de masas de Cl entre ambos compuestos?", type: "choice", options: ["2:3", "1:1", "1:2", "3:4"], correct: 0, explanation: "MCl‚ÇÇ tiene 2 Cl, MCl‚ÇÉ tiene 3 Cl. Relaci√≥n 2:3." },
                { q: "Azufre forma SO‚ÇÇ y SO‚ÇÉ. Para una misma masa de azufre, ¬øcu√°l es la relaci√≥n de ox√≠genos?", type: "choice", options: ["1:1", "2:3", "1:2", "3:4"], correct: 1, explanation: "SO‚ÇÇ (2 √°tomos O) vs SO‚ÇÉ (3 √°tomos O). Relaci√≥n 2:3." },
                { q: "Agua (H‚ÇÇO) vs per√≥xido de hidr√≥geno (H‚ÇÇO‚ÇÇ). Para 2g de H, tenemos 16g O en agua y 32g O en per√≥xido. ¬øRelaci√≥n de O?", type: "choice", options: ["1:1", "1:2", "1:3", "2:3"], correct: 1, explanation: "16g:32g se simplifica a 1:2." },
                { q: "El cobre forma CuCl (cloruro cuproso) y CuCl‚ÇÇ (cloruro c√∫prico). Fijando la masa de Cu, ¬øcu√°l es la relaci√≥n de Cl?", type: "choice", options: ["1:2", "1:1", "2:1", "3:1"], correct: 0, explanation: "CuCl (1 Cl) vs CuCl‚ÇÇ (2 Cl). Relaci√≥n 1:2." },
                { q: "¬øQui√©n propuso la teor√≠a at√≥mica para explicar estas relaciones de n√∫meros enteros sencillos?", type: "choice", options: ["Lavoisier", "Proust", "Dalton", "Bohr"], correct: 2, explanation: "John Dalton formul√≥ la teor√≠a at√≥mica moderna." },
                { q: "El f√≥sforo forma PCl‚ÇÉ y PCl‚ÇÖ. ¬øRelaci√≥n de cloro para la misma masa de f√≥sforo?", type: "choice", options: ["1:2", "3:5", "5:3", "1:1"], correct: 1, explanation: "PCl‚ÇÉ (3 Cl) vs PCl‚ÇÖ (5 Cl). Relaci√≥n 3:5." },
                { q: "√ìxidos de hierro: FeO y Fe‚ÇÇO‚ÇÉ. ¬øCu√°l es aproximadamente la relaci√≥n de O por gramo de Fe?", type: "choice", options: ["1:1.5 (o 2:3)", "1:1", "1:2", "3:2"], correct: 0, explanation: "FeO (proporci√≥n 1:1), Fe‚ÇÇO‚ÇÉ (proporci√≥n 2:3). Relaci√≥n aproximada 1:1.5." },
                { q: "El manganeso forma MnO y MnO‚ÇÇ. ¬øRelaci√≥n de masas de ox√≠geno para una masa fija de Mn?", type: "choice", options: ["1:1", "1:2", "2:3", "1:3"], correct: 1, explanation: "MnO (1 √°tomo O) vs MnO‚ÇÇ (2 √°tomos O). Relaci√≥n 1:2." },
                { q: "Compuesto I contiene 14g N + 16g O. Compuesto II contiene 14g N + 48g O. ¬øRelaci√≥n de ox√≠geno entre I y II?", type: "choice", options: ["1:2", "1:3", "2:3", "3:4"], correct: 1, explanation: "Fijando N en 14g: 16g vs 48g de O. 16:48 = 1:3." },
                { q: "Un elemento A forma AX y AX‚ÇÉ. Si AX contiene 10g de X por gramo de A, ¬øcu√°nto X contiene AX‚ÇÉ por gramo de A?", type: "numeric", val: 30, units: ["g", "gr", "gramos"], explanation: "Si la proporci√≥n at√≥mica es 1:3, la masa de X se triplica: 10g √ó 3 = 30g." },
                { q: "El cromo forma dos √≥xidos: CrO (verde) y CrO‚ÇÉ (rojo). Para la misma masa de cromo, ¬ørelaci√≥n de ox√≠geno?", type: "choice", options: ["1:2", "1:3", "2:3", "3:1"], correct: 1, explanation: "CrO (1 O) vs CrO‚ÇÉ (3 O). Relaci√≥n 1:3." },
                { q: "Compuesto A tiene 50% S y 50% O. Compuesto B tiene 40% S y 60% O. Para la misma masa de S, ¬ørelaci√≥n de O en A:B?", type: "choice", options: ["1:1", "2:3", "3:2", "1:2"], correct: 1, explanation: "A: 1g O por 1g S. B: 1.5g O por 1g S. Relaci√≥n 1:1.5 = 2:3." }
            ],
            richter: [
                { q: "Si A:B es 2:1 y A:C es 2:3 (siendo A el elemento puente con valor 2), ¬øcu√°l es la relaci√≥n B:C?", type: "choice", options: ["1:3", "1:1", "2:3", "3:1"], correct: 0, explanation: "A es constante (2). Comparamos B(1) con C(3). Relaci√≥n B:C = 1:3." },
                { q: "H‚ÇÇO (H:O = 1:8) y CO‚ÇÇ (C:O = 3:8). Usando O como puente (8g), ¬ørelaci√≥n esperada C:H?", type: "choice", options: ["12:1", "3:1", "1:3", "1:4"], correct: 1, explanation: "Para 8g O: C = 3g, H = 1g. Relaci√≥n C:H = 3:1." },
                { q: "¬øQu√© concepto qu√≠mico fundamenta la ley de proporciones rec√≠procas de Richter?", type: "choice", options: ["Velocidad de reacci√≥n", "Pesos equivalentes", "Teor√≠a de gases", "Energ√≠a de activaci√≥n"], correct: 1, explanation: "Pesos de combinaci√≥n equivalentes o pesos equivalentes." },
                { q: "H‚ÇÇS (S:H = 16:1) y H‚ÇÇO (O:H = 8:1). Usando H como puente (1g), ¬ørelaci√≥n S:O esperada?", type: "choice", options: ["16:8 (o 2:1)", "1:1", "8:16", "1:2"], correct: 0, explanation: "Para 1g H: S = 16g, O = 8g. Relaci√≥n S:O = 16:8 = 2:1 (forma SO‚ÇÇ)." },
                { q: "Tienes datos de Na-Cl y K-Cl. ¬øEstos datos sirven para aplicar la ley de Richter?", type: "choice", options: ["S√≠, Cl es el puente", "No, falta un tercer elemento", "Depende de las masas", "Quiz√°s en ciertos casos"], correct: 0, explanation: "Cl act√∫a como elemento puente para relacionar Na con K." },
                { q: "Si X reacciona con Y (masa m1) y X reacciona con Z (masa m2), entonces Y y Z reaccionan entre s√≠ en proporci√≥n:", type: "choice", options: ["m1:m2", "m1:m1", "Aleatoria", "No pueden reaccionar"], correct: 0, explanation: "Definici√≥n de Richter: la proporci√≥n es m1:m2." },
                { q: "Usando ox√≠geno como elemento puente, si conoces Ca-O y S-O, ¬øqu√© relaci√≥n puedes deducir?", type: "choice", options: ["Ca-S", "O-O", "Ca-Ca", "Ninguna"], correct: 0, explanation: "El puente O permite relacionar Ca con S directamente." },
                { q: "H-Cl (1:35.5) y H-Na (1:23). Usando H como puente, ¬ørelaci√≥n de Na:Cl en sal com√∫n (NaCl)?", type: "choice", options: ["23:35.5", "1:1", "35.5:23", "2:1"], correct: 0, explanation: "Na(23) se combina con Cl(35.5). Relaci√≥n directa 23:35.5." },
                { q: "NH‚ÇÉ (N:H = 14:3) y NO (N:O = 14:16). Usando N como puente (14g), ¬ørelaci√≥n H:O?", type: "choice", options: ["3:16", "1:1", "16:3", "3:8"], correct: 0, explanation: "Para 14g N: H = 3g, O = 16g. Relaci√≥n H:O = 3:16." },
                { q: "CS‚ÇÇ (C:S = 6:32) y CO‚ÇÇ (C:O = 6:16). Con C como puente (6g), ¬ørelaci√≥n S:O?", type: "choice", options: ["32:16 (o 2:1)", "1:1", "16:32", "1:2"], correct: 0, explanation: "Para 6g C: S = 32g, O = 16g. Relaci√≥n S:O = 32:16 = 2:1." },
                { q: "Si 1g de H reacciona con 35.5g Cl, y 1g H reacciona con 8g O, ¬øcu√°l es el peso equivalente del Cl respecto al O?", type: "choice", options: ["35.5 / 8", "1 / 1", "8 / 35.5", "35.5 √ó 8"], correct: 0, explanation: "Se comparan masas que reaccionan con igual H. Relaci√≥n 35.5:8." },
                { q: "Elemento A reacciona con 8g O. Elemento B tambi√©n reacciona con 8g O. Si A reacciona con B, la relaci√≥n de masas A:B ser√°:", type: "choice", options: ["Masa_A : Masa_B", "Siempre 1:1", "Masa_A √ó Masa_B", "8:8"], correct: 0, explanation: "Con el mismo puente (8g O), reaccionan en proporci√≥n de sus pesos equivalentes propios." },
                { q: "Mg-H (12:1) y O-H (8:1). Seg√∫n Richter, ¬øqu√© relaci√≥n predice para el √≥xido de magnesio (MgO)?", type: "choice", options: ["MgO (24:16 o 3:2)", "MgO‚ÇÇ", "Mg‚ÇÇO", "MgH‚ÇÇ"], correct: 0, explanation: "Relaci√≥n Mg:O = 12:8 = 3:2. En t√©rminos m√°s comunes: 24:16." },
                { q: "H‚ÇÇS (1:16) y H‚ÇÇO (1:8). Richter predice S:O = 16:8 (2:1). En SO‚ÇÇ real es 32:32 (1:1). ¬øHay contradicci√≥n?", type: "choice", options: ["No, es un m√∫ltiplo", "S√≠, Richter falla", "Depende temperatura", "Error experimental"], correct: 0, explanation: "2:1 vs 1:1 difiere por un factor 2 (m√∫ltiplo sencillo), explicable por Dalton." },
                { q: "Elemento X (Equiv=20) y Elemento Y (Equiv=40). ¬øRelaci√≥n de masa m√°s simple para XY?", type: "choice", options: ["1:2", "2:1", "1:1", "1:4"], correct: 0, explanation: "20:40 simplificado = 1:2." }
            ]
        };

        let currentQuizState = { law: '', questions: [], currentIndex: 0, score: 0 };

        function startQuiz(law) {
            document.getElementById(`start-screen-${law}`).classList.add('hidden');
            const container = document.getElementById(`quiz-container-${law}`);
            container.classList.remove('hidden');
            
            const allQuestions = [...exercisesDB[law]]; 
            for (let i = allQuestions.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [allQuestions[i], allQuestions[j]] = [allQuestions[j], allQuestions[i]];
            }
            
            currentQuizState = { law: law, questions: allQuestions, currentIndex: 0, score: 0 };
            renderQuestion();
        }

        function renderQuestion() {
            const { law, questions, currentIndex, score } = currentQuizState;
            const container = document.getElementById(`quiz-container-${law}`);
            if (!questions || !questions[currentIndex]) return;

            const q = questions[currentIndex];
            const progress = ((currentIndex + 1) / questions.length) * 100;
            let inputHTML = '';
            
            if (q.type === 'numeric') {
                inputHTML = `
                    <div class="mb-6">
                        <label class="block text-sm font-bold text-slate-700 mb-3">
                            üí≠ Tu respuesta (n√∫mero + unidad, ej: <span class="text-blue-600">10g</span>):
                        </label>
                        <input type="text" id="numeric-input" class="w-full p-4 border-2 border-slate-300 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 outline-none text-lg" placeholder="Ejemplo: 45.5g o 12 gramos" autocomplete="off">
                    </div>
                `;
            } else {
                inputHTML = '<div class="space-y-3 mb-6">';
                q.options.forEach((opt, idx) => {
                    inputHTML += `
                        <label class="block p-4 border-2 border-slate-200 rounded-xl cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition group">
                            <input type="radio" name="current-q" value="${idx}" class="mr-3 text-blue-600 w-4 h-4">
                            <span class="text-slate-700 group-hover:text-blue-800 font-medium">${opt}</span>
                        </label>
                    `;
                });
                inputHTML += '</div>';
            }

            const colorClasses = {
                lavoisier: {
                    iconBg: 'bg-blue-100',
                    btnGradient: 'bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800'
                },
                proust: {
                    iconBg: 'bg-indigo-100',
                    btnGradient: 'bg-gradient-to-r from-indigo-600 to-indigo-700 hover:from-indigo-700 hover:to-indigo-800'
                },
                dalton: {
                    iconBg: 'bg-orange-100',
                    btnGradient: 'bg-gradient-to-r from-orange-600 to-orange-700 hover:from-orange-700 hover:to-orange-800'
                },
                richter: {
                    iconBg: 'bg-purple-100',
                    btnGradient: 'bg-gradient-to-r from-purple-600 to-purple-700 hover:from-purple-700 hover:to-purple-800'
                }
            };
            const colors = colorClasses[law] || colorClasses.lavoisier;

            container.innerHTML = `
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-2 text-xs font-bold text-slate-500 uppercase tracking-widest">
                        <span>Pregunta ${currentIndex + 1} de ${questions.length}</span>
                        <span class="text-green-600">‚úì Aciertos: ${score}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progress}%; background: linear-gradient(90deg, #3b82f6, #2563eb)"></div>
                    </div>
                </div>
                
                <div class="exercise-card bg-gradient-to-br from-white to-slate-50 p-8 rounded-2xl border-2 border-slate-200 shadow-lg">
                    <div class="flex items-start mb-6">
                        <div class="w-10 h-10 ${colors.iconBg} rounded-full flex items-center justify-center mr-4 flex-shrink-0">
                            <span class="text-xl">‚ùì</span>
                        </div>
                        <h4 class="text-lg font-bold text-slate-800 leading-relaxed">${q.q}</h4>
                    </div>
                    
                    ${inputHTML}
                    
                    <div id="feedback-area" class="hidden mb-6 p-4 rounded-xl text-sm border-2"></div>
                    
                    <div class="flex justify-end gap-3">
                        <button id="btn-check" onclick="window.submitAnswer()" class="${colors.btnGradient} text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition">
                            ‚úì Comprobar
                        </button>
                        <button id="btn-next" onclick="window.nextQuestion()" class="hidden bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-800 hover:to-slate-900 text-white px-8 py-3 rounded-xl font-bold shadow-lg hover:shadow-xl transform hover:scale-105 transition flex items-center gap-2">
                            Siguiente <span class="text-xl">‚Üí</span>
                        </button>
                    </div>
                </div>
            `;
        }

        function submitAnswer() {
            console.log('=== submitAnswer llamada ===');
            console.log('currentQuizState:', currentQuizState);
            
            const { questions, currentIndex } = currentQuizState;
            const q = questions[currentIndex];
            
            console.log('Pregunta actual:', q);
            
            const feedback = document.getElementById('feedback-area');
            const btnCheck = document.getElementById('btn-check');
            const btnNext = document.getElementById('btn-next');
            
            console.log('Elementos DOM:', {feedback, btnCheck, btnNext});
            
            if (!feedback || !btnCheck || !btnNext) {
                console.error('ERROR: Elementos no encontrados');
                alert('Error: No se encontraron los elementos necesarios. Por favor recarga la p√°gina.');
                return;
            }
            
            let isCorrect = false;
            let errorDetails = "";

            if (q.type === 'numeric') {
                const inputEl = document.getElementById('numeric-input');
                if (!inputEl) {
                    console.error('ERROR: Input num√©rico no encontrado');
                    return;
                }
                
                const inputVal = inputEl.value.trim();
                
                if (!inputVal) {
                    alert("‚ö†Ô∏è Por favor escribe una respuesta.");
                    return;
                }
                
                const regex = /^([\d\.,]+)\s*([a-zA-Z√°√©√≠√≥√∫√Å√â√ç√ì√ö%]*)$/;
                const match = inputVal.match(regex);
                
                if (match) {
                    let num = parseFloat(match[1].replace(',', '.'));
                    let unit = match[2] ? match[2].toLowerCase().trim() : "";
                    
                    console.log('Validando num√©rica:', {num, unit, esperado: q.val, unidades: q.units});
                    
                    if (isNaN(num)) {
                        errorDetails = "El valor ingresado no es un n√∫mero v√°lido.";
                    } else {
                        const margin = q.val * 0.05;
                        const numOk = Math.abs(num - q.val) <= Math.max(margin, 0.1);
                        const unitOk = unit === "" || q.units.some(u => unit.includes(u.toLowerCase()));
                        
                        if (numOk && unitOk) {
                            isCorrect = true;
                        } else {
                            if (!numOk) errorDetails = `El valor num√©rico es incorrecto (esperado: ${q.val}). `;
                            if (!unitOk) errorDetails += `La unidad es incorrecta (esperadas: ${q.units.join(', ')}). `;
                        }
                    }
                } else { 
                    errorDetails = "Formato no v√°lido. Usa: n√∫mero + unidad (ej: 10g)."; 
                }
                
                inputEl.disabled = true;
            } else {
                console.log('Pregunta tipo choice');
                const selected = document.querySelector('input[name="current-q"]:checked');
                console.log('Radio seleccionado:', selected);
                
                if (!selected) {
                    alert("‚ö†Ô∏è Por favor selecciona una respuesta.");
                    return;
                }
                
                const selectedValue = parseInt(selected.value);
                console.log('Valor seleccionado:', selectedValue, 'Correcto:', q.correct);
                
                if (selectedValue === q.correct) {
                    isCorrect = true;
                }
                
                document.querySelectorAll('input[name="current-q"]').forEach(i => i.disabled = true);
            }

            console.log('¬øEs correcta?', isCorrect);

            btnCheck.classList.add('hidden');
            btnNext.classList.remove('hidden');
            feedback.classList.remove('hidden');

            if (isCorrect) {
                currentQuizState.score++;
                feedback.className = "mb-6 p-5 rounded-xl text-sm bg-gradient-to-r from-green-50 to-emerald-50 text-green-800 border-2 border-green-300";
                feedback.innerHTML = `
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">‚úÖ</span>
                        <div>
                            <strong class="text-lg">¬°Excelente! Respuesta correcta</strong>
                            <p class="mt-2 text-green-700">${q.explanation}</p>
                        </div>
                    </div>
                `;
            } else {
                feedback.className = "mb-6 p-5 rounded-xl text-sm bg-gradient-to-r from-red-50 to-orange-50 text-red-800 border-2 border-red-300";
                feedback.innerHTML = `
                    <div class="flex items-start">
                        <span class="text-2xl mr-3">‚ùå</span>
                        <div>
                            <strong class="text-lg">Respuesta incorrecta</strong>
                            ${errorDetails ? `<p class="mt-2 text-red-700 font-medium">${errorDetails}</p>` : ''}
                            <p class="mt-2 text-red-700"><strong>Explicaci√≥n:</strong> ${q.explanation}</p>
                        </div>
                    </div>
                `;
            }
            
            console.log('=== submitAnswer completada ===');
        }
        
        // Exponer funciones globalmente
        window.submitAnswer = submitAnswer;

        function nextQuestion() {
            currentQuizState.currentIndex++;
            if (currentQuizState.currentIndex < currentQuizState.questions.length) {
                renderQuestion();
            } else {
                showResults();
            }
        }
        
        // Exponer funci√≥n globalmente
        window.nextQuestion = nextQuestion;

        function showResults() {
            const { law, score, questions } = currentQuizState;
            const container = document.getElementById(`quiz-container-${law}`);
            const percentage = (score / questions.length) * 100;
            
            let message, emoji, color;
            if (percentage === 100) { 
                message = "¬°Perfecto! Dominas completamente esta ley"; 
                emoji = "üèÜ"; 
                color = "text-yellow-600"; 
            } else if (percentage >= 80) { 
                message = "¬°Excelente! Muy buen dominio del tema"; 
                emoji = "üåü"; 
                color = "text-green-600"; 
            } else if (percentage >= 60) { 
                message = "¬°Bien! Vas por buen camino"; 
                emoji = "üëç"; 
                color = "text-blue-600"; 
            } else { 
                message = "Sigue practicando, mejorar√°s"; 
                emoji = "üìö"; 
                color = "text-orange-600"; 
            }

            container.innerHTML = `
                <div class="bg-gradient-to-br from-white to-slate-50 p-12 rounded-2xl shadow-2xl text-center exercise-card border-2 border-slate-200">
                    <div class="text-8xl mb-6">${emoji}</div>
                    <h3 class="text-3xl font-bold text-slate-800 mb-3">Test Completado</h3>
                    <div class="text-6xl font-bold ${color} mb-4">${score} / ${questions.length}</div>
                    <div class="bg-slate-100 rounded-full h-4 mb-6 max-w-md mx-auto overflow-hidden">
                        <div class="bg-gradient-to-r from-blue-500 to-green-500 h-full rounded-full transition-all duration-1000" style="width: ${percentage}%"></div>
                    </div>
                    <p class="text-xl text-slate-700 mb-8 font-medium">${message}</p>
                    <button onclick="resetQuiz('${law}')" class="bg-gradient-to-r from-slate-700 to-slate-800 hover:from-slate-800 hover:to-slate-900 text-white px-10 py-4 rounded-full font-bold text-lg shadow-xl transform hover:scale-110 transition">
                        üîÑ Intentar de Nuevo
                    </button>
                </div>
            `;
        }

        function resetQuiz(law) {
            document.getElementById(`quiz-container-${law}`).classList.add('hidden');
            document.getElementById(`start-screen-${law}`).classList.remove('hidden');
        }

        function switchTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
            document.getElementById('tab-' + tabId).classList.add('active');
            document.getElementById('btn-' + tabId).classList.add('active');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        let lavoisierRunning = false;
        let systemOpen = false;

        function initLavoisier() {
            const flask = document.getElementById('flask-contents');
            if(!flask) return;
            flask.innerHTML = '';
            document.getElementById('gas-container').innerHTML = '';
            document.getElementById('flask-stopper').classList.remove('opacity-0', 'translate-y-[-50px]');
            document.getElementById('btn-react-lavoisier').classList.remove('hidden');
            document.getElementById('btn-open-lavoisier').classList.add('hidden');
            document.getElementById('scale-value').innerText = "250.00 g";
            document.getElementById('lavoisier-result').classList.add('hidden');
            
            for(let i=0; i<12; i++) {
                createParticle(flask, 'particle-reactant-a'); 
                createParticle(flask, 'particle-reactant-b'); 
            }
            lavoisierRunning = false;
            systemOpen = false;
        }

        function createParticle(container, typeClass) {
            const p = document.createElement('div');
            p.className = `w-5 h-5 rounded-full absolute transition-all duration-1000 ${typeClass}`;
            p.style.bottom = Math.random() * 80 + 'px';
            p.style.left = Math.random() * 180 + 'px';
            container.appendChild(p);
        }

        function runLavoisier() {
            if(lavoisierRunning) return;
            lavoisierRunning = true;
            
            const flask = document.getElementById('flask-contents');
            const scaleDisplay = document.getElementById('scale-value');
            
            let intervals = 0;
            const reactionInterval = setInterval(() => {
                intervals++;
                scaleDisplay.innerText = (250.00 + (Math.random() * 0.2 - 0.1)).toFixed(2) + " g";
                
                Array.from(flask.children).forEach(p => {
                     p.style.transform = `translate(${Math.random()*10 - 5}px, ${Math.random()*10 - 5}px)`;
                });

                if(intervals === 25) {
                    clearInterval(reactionInterval);
                    scaleDisplay.innerText = "250.00 g"; 
                    finishLavoisierStep1();
                }
            }, 80);
        }

        function finishLavoisierStep1() {
            const flask = document.getElementById('flask-contents');
            const gasContainer = document.getElementById('gas-container');
            
            Array.from(flask.children).forEach(p => {
                p.className = `w-5 h-5 rounded-full absolute transition-all duration-1000 particle-product-liq`;
            });

            for(let i=0; i<12; i++) {
                const bubble = document.createElement('div');
                bubble.className = "w-5 h-5 rounded-full absolute particle-gas";
                bubble.style.left = (Math.random() * 180) + 10 + 'px';
                bubble.style.top = (Math.random() * 100) + 'px';
                gasContainer.appendChild(bubble);
            }

            const resDiv = document.getElementById('lavoisier-result');
            resDiv.innerHTML = `
                <div class="flex items-start">
                    <div class="w-10 h-10 bg-green-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                        <span class="text-xl">‚úì</span>
                    </div>
                    <div>
                        <h4 class='font-bold text-green-700 text-lg mb-1'>Fase 1: Sistema Cerrado</h4>
                        <p class='text-sm text-slate-700'>Se ha producido gas CO‚ÇÇ (part√≠culas grises), pero al estar el recipiente tapado, <strong>la masa total NO cambia</strong>. La balanza sigue marcando 250.00g.</p>
                    </div>
                </div>
            `;
            resDiv.classList.remove('hidden');
            
            document.getElementById('btn-react-lavoisier').classList.add('hidden');
            document.getElementById('btn-open-lavoisier').classList.remove('hidden');
        }

        function openSystem() {
            if(systemOpen) return;
            systemOpen = true;
            
            document.getElementById('flask-stopper').classList.add('opacity-0', 'translate-y-[-50px]');
            
            const bubbles = document.querySelectorAll('.particle-gas');
            bubbles.forEach(b => {
                b.classList.remove('particle-gas');
                b.classList.add('gas-escaping');
                b.style.setProperty('--tx', (Math.random() * 100 - 50) + 'px');
            });

            const scaleDisplay = document.getElementById('scale-value');
            let currentMass = 250.00;
            const targetMass = 244.50; 
            
            const massInterval = setInterval(() => {
                currentMass -= 0.12;
                scaleDisplay.innerText = currentMass.toFixed(2) + " g";
                
                if(currentMass <= targetMass) {
                    clearInterval(massInterval);
                    scaleDisplay.innerText = targetMass.toFixed(2) + " g";
                    const resDiv = document.getElementById('lavoisier-result');
                    resDiv.innerHTML += `
                        <div class='mt-4 pt-4 border-t-2 border-slate-300'>
                            <div class="flex items-start">
                                <div class="w-10 h-10 bg-orange-100 rounded-full flex items-center justify-center mr-3 flex-shrink-0">
                                    <span class="text-xl">üîì</span>
                                </div>
                                <div>
                                    <h4 class='font-bold text-orange-700 text-lg mb-1'>Fase 2: Sistema Abierto</h4>
                                    <p class='text-sm text-slate-700'>El gas CO‚ÇÇ escapa al ambiente. La balanza marca menos (${targetMass}g), pero <strong>la masa total del universo se conserva</strong>. El gas simplemente cambi√≥ de lugar.</p>
                                </div>
                            </div>
                        </div>
                    `;
                }
            }, 40);
        }

        function resetLavoisier() { initLavoisier(); }

        function updateProustInput() {
            const h = parseInt(document.getElementById('input-h').value);
            const o = parseInt(document.getElementById('input-o').value);
            document.getElementById('val-h').innerText = h + "g";
            document.getElementById('val-o').innerText = o + "g";
            renderReactantsProust(h, o);
            document.getElementById('container-products-water').innerHTML = '';
            document.getElementById('container-products-excess').innerHTML = '<span class="text-slate-400 text-sm italic w-full text-center mt-6 opacity-60">Esperando reacci√≥n...</span>';
            document.getElementById('proust-feedback').classList.add('hidden');
        }
        
        function renderReactantsProust(massH, massO) {
            const container = document.getElementById('container-reactants');
            if(!container) return;
            container.innerHTML = '';
            
            const numH2 = Math.floor(massH / 2); 
            const numO2 = Math.floor(massO / 32);

            for(let i=0; i<numH2; i++) {
                container.innerHTML += `<div class="molecule-h2 p-2 border-2 border-slate-200 rounded-lg bg-white shadow-sm hover:shadow-md transition" title="H‚ÇÇ (2g)"><div class="atom-h"></div><div class="atom-h"></div></div>`;
            }
            for(let i=0; i<numO2; i++) {
                container.innerHTML += `<div class="molecule-o2 p-2 border-2 border-red-100 rounded-lg bg-white shadow-sm hover:shadow-md transition" title="O‚ÇÇ (32g)"><div class="atom-o"></div><div class="atom-o"></div></div>`;
            }
            
            if (numH2 === 0 && numO2 === 0) {
                container.innerHTML = '<span class="text-slate-400 text-sm italic w-full text-center opacity-60">Sin reactivos</span>';
            }
        }

        function calculateProust() {
            const massH = parseFloat(document.getElementById('input-h').value);
            const massO = parseFloat(document.getElementById('input-o').value);
            
            const availH2 = Math.floor(massH / 2);
            const availO2 = Math.floor(massO / 32);
            
            let reactingO2 = 0, reactingH2 = 0;
            
            if (availH2 >= 2 * availO2) {
                reactingO2 = availO2;
                reactingH2 = 2 * availO2;
            } else {
                const numReactions = Math.floor(availH2 / 2);
                reactingH2 = numReactions * 2;
                reactingO2 = numReactions;
            }
            
            const formedWater = reactingO2 * 2;
            const leftH2 = availH2 - reactingH2;
            const leftO2 = availO2 - reactingO2;
            
            const massWater = formedWater * 18; 
            const massLeftH = leftH2 * 2;
            const massLeftO = leftO2 * 32;

            const containerWater = document.getElementById('container-products-water');
            containerWater.innerHTML = '';
            for(let i=0; i<formedWater; i++) {
                containerWater.innerHTML += `<div class="molecule-h2o reaction-flash border-2 border-blue-200 rounded-lg p-1 bg-white shadow-sm"><div class="atom-o"></div><div class="atom-h"></div><div class="atom-h"></div></div>`;
            }
            
            if (formedWater === 0 && (availH2>0 || availO2>0)) {
                 containerWater.innerHTML = '<span class="text-slate-400 text-sm italic text-center w-full mt-4">No se form√≥ agua<br>(proporci√≥n insuficiente)</span>';
            }

            const containerExcess = document.getElementById('container-products-excess');
            containerExcess.innerHTML = '';
            
            if (leftO2 > 0) {
                for(let i=0; i<leftO2; i++) {
                    containerExcess.innerHTML += `<div class="molecule-o2 p-2 border-2 border-red-200 rounded-lg bg-white shadow-sm opacity-75"><div class="atom-o"></div><div class="atom-o"></div></div>`;
                }
            }
            if (leftH2 > 0) {
                for(let i=0; i<leftH2; i++) {
                    containerExcess.innerHTML += `<div class="molecule-h2 p-2 border-2 border-slate-300 rounded-lg bg-white shadow-sm opacity-75"><div class="atom-h"></div><div class="atom-h"></div></div>`;
                }
            }
            
            if (leftO2 === 0 && leftH2 === 0 && formedWater > 0) {
                containerExcess.innerHTML = '<span class="text-green-600 text-sm italic font-bold w-full text-center mt-6">‚úì ¬°Reacci√≥n Completa!<br>No sobra nada</span>';
            }

            const feedback = document.getElementById('proust-feedback');
            let feedbackText = `<strong>Resultado:</strong> Se formaron <span class="text-blue-700 font-bold">${massWater}g de agua</span> (${formedWater} mol√©culas). `;
            
            if (massLeftO > 0) feedbackText += `<div class="mt-2 text-red-700">‚ö†Ô∏è Sobraron <strong>${massLeftO}g de ox√≠geno</strong> (${leftO2} mol√©culas).</div>`;
            if (massLeftH > 0) feedbackText += `<div class="mt-2 text-blue-700">‚ö†Ô∏è Sobraron <strong>${massLeftH}g de hidr√≥geno</strong> (${leftH2} mol√©culas).</div>`;
            
            feedback.innerHTML = feedbackText;
            feedback.classList.remove('hidden');
            feedback.className = "mt-4 p-4 bg-gradient-to-r from-indigo-50 to-purple-50 rounded-xl border-2 border-indigo-200 text-sm block";
        }

        function runDalton(mode) {
            const stage = document.getElementById('dalton-stage');
            const ratioBox = document.getElementById('dalton-ratio');
            stage.innerHTML = '';
            ratioBox.classList.remove('hidden');
            
            const carbonHTML = `
                <div class="flex flex-col items-center">
                    <div class="atom-c mb-3 shadow-lg"></div>
                    <span class="text-sm text-slate-300 font-bold">12g Carbono</span>
                </div>
            `;
            
            if (mode === 1) {
                stage.innerHTML = `
                    <div class="flex items-center gap-8 slide-in">
                        ${carbonHTML}
                        <div class="text-3xl text-slate-500 font-bold">+</div>
                        <div class="flex flex-col items-center">
                            <div class="atom-o bg-red-500 mb-3 shadow-lg"></div>
                            <span class="text-sm text-slate-300 font-bold">16g Ox√≠geno</span>
                        </div>
                        <div class="text-3xl text-yellow-400 font-bold">‚Üí</div>
                        <div class="flex flex-col items-center">
                            <div class="molecule-co p-3 bg-white/10 rounded-xl border-2 border-white/30 shadow-xl">
                                <div class="atom-c"></div>
                                <div class="atom-o"></div>
                            </div>
                            <span class="text-sm text-green-400 mt-3 font-bold">Mon√≥xido (CO)</span>
                        </div>
                    </div>
                `;
            } else {
                stage.innerHTML = `
                    <div class="flex items-center gap-8 slide-in">
                        ${carbonHTML}
                        <div class="text-3xl text-slate-500 font-bold">+</div>
                        <div class="flex flex-col items-center">
                            <div class="molecule-o2 mb-3 shadow-lg">
                                <div class="atom-o"></div>
                                <div class="atom-o"></div>
                            </div>
                            <span class="text-sm text-slate-300 font-bold">32g Ox√≠geno</span>
                        </div>
                        <div class="text-3xl text-yellow-400 font-bold">‚Üí</div>
                        <div class="flex flex-col items-center">
                            <div class="molecule-co2 p-3 bg-white/10 rounded-xl border-2 border-white/30 shadow-xl">
                                <div class="atom-o"></div>
                                <div class="atom-c"></div>
                                <div class="atom-o"></div>
                            </div>
                            <span class="text-sm text-green-400 mt-3 font-bold">Di√≥xido (CO‚ÇÇ)</span>
                        </div>
                    </div>
                `;
            }
        }

        function runRichter(step) {
            const res1 = document.getElementById('richter-res-1');
            const res2 = document.getElementById('richter-res-2');
            const res3 = document.getElementById('richter-res-3');
            
            if (step === 1) {
                res1.style.opacity = '1';
                res1.innerHTML = `
                    <div class="flex flex-col items-center p-2">
                        <div class="molecule-co2 scale-90 mb-2">
                            <div class="atom-o"></div>
                            <div class="atom-c"></div>
                            <div class="atom-o"></div>
                        </div>
                        <span class="text-xs font-bold text-slate-600">CO‚ÇÇ</span>
                        <span class="text-[10px] text-slate-500">(12g C : 32g O)</span>
                    </div>
                `;
            } else if (step === 2) {
                res2.style.opacity = '1';
                res2.innerHTML = `
                    <div class="flex flex-col items-center p-2">
                        <div class="flex gap-1 mb-2">
                            <div class="molecule-h2o scale-75">
                                <div class="atom-o"></div>
                                <div class="atom-h"></div>
                                <div class="atom-h"></div>
                            </div>
                            <div class="molecule-h2o scale-75">
                                <div class="atom-o"></div>
                                <div class="atom-h"></div>
                                <div class="atom-h"></div>
                            </div>
                        </div>
                        <span class="text-xs font-bold text-slate-600">2 H‚ÇÇO</span>
                        <span class="text-[10px] text-slate-500">(4g H : 32g O)</span>
                    </div>
                `;
            } else if (step === 3) {
                if (res1.style.opacity !== '1' || res2.style.opacity !== '1') {
                    alert("‚ö†Ô∏è ¬°Realiza primero los pasos 1 y 2 para obtener los datos necesarios!");
                    return;
                }
                res3.style.opacity = '1';
                res3.innerHTML = `
                    <div class="flex items-center gap-3 slide-in p-2">
                        <div class="molecule-ch4 shadow-lg">
                            <div class="atom-h"></div>
                            <div class="atom-h"></div>
                            <div class="atom-h"></div>
                            <div class="atom-h"></div>
                            <div class="atom-c"></div>
                        </div>
                        <div class="text-left">
                            <div class="font-bold text-indigo-800 text-sm">Metano (CH‚ÇÑ)</div>
                            <div class="text-xs text-slate-600">12g C : 4g H</div>
                            <div class="text-green-600 font-bold text-xs mt-1">‚úì ¬°Proporci√≥n Correcta!</div>
                        </div>
                    </div>
                `;
            }
        }

        window.onload = function() {
            initLavoisier();
            updateProustInput();
            console.log("‚úÖ Laboratorio de Leyes Ponderales cargado exitosamente");
        };
    </script>
</body>
</html>
